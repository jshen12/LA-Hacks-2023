import React, { useState, useEffect } from "react";
import { Link, useNavigate } from "react-router-dom";
import { getDocs, addDoc, collection } from "firebase/firestore";
import { db } from "../firebase-config";
import Listings from "../components/Listings";
import CreateListing from "./CreateListing";

const RestaurantPage = ({}) => {
  const navigate = useNavigate();

  const [isPopUpForm, setIsPopUpForm] = useState(false);

  const handlePopUpForm = () => {};

  const restaurantsRef = collection(db, "restaurants");
  const listingsRef = collection(db, "listings");

  const loggedInRestaurantId = getLocalStorage("rest_id");
  const loggedInRestaurant = null;
  const loggedInRestaurantListings = [];

  useEffect(async () => {
    loggedInRestaurant = await getDocs(restaurantsRef, {
      _id: loggedInRestaurantId,
    });

    const listings = await getDocs(listingsRef);
    listings.forEach((listing) => {
      if (listing.rest_id == loggedInRestaurantId) {
        loggedInRestaurantListings.push(listing);
      }
    });
  }, []);

  return (
    <div className="user-page">
      <div className="rest-info-container">
        <div className="rest-name-container">
          <h2>{loggedInRestaurant.name}</h2>
        </div>
        <div className="rest-address-container">
          <h3>{loggedInRestaurant.address}</h3>
        </div>
      </div>
      <div className="rest-listings-container">
        <Listings listings={loggedInRestaurantListings} />
        <div
          style={{
            display: "flex",
            justifyContent: "center",
            alignContent: "center",
            padding: "2rem",
          }}
        >
          <button className="add-listing-button">Add Listing</button>
        </div>
        <CreateListing setIsPopUpForm={setIsPopUpForm} />
      </div>
    </div>
  );
};

export default RestaurantPage;
